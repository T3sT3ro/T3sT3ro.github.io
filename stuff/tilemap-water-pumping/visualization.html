<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tilemap Water Pumping</title>
    <link rel="stylesheet" href="https://unpkg.com/open-props">
    <script>
        // Cache busting for CSS and JS files
        const cacheBuster = Date.now();
        document.write(`<link rel="stylesheet" href="styles.css?v=${cacheBuster}">`);
    </script>
</head>

<body>
    <div>
        <canvas id="canvas"></canvas>
    </div>
    <div id="controls">
        <div id="topControls">
            <div id="buttons" class="control-box">
                <h4>Actions <span id="tickCounterDisplay" style="float: right; font-weight: normal; font-size: inherit;">Tick: 0</span></h4>
                <div class="button-group">
                    <button id="tickBtn">Tick</button>
                    <button id="randomizeBtn">Randomize Heights</button>
                    <button id="clearPumps">Clear Pumps</button>
                    <button id="clearWater">Clear All Water</button>
                </div>
            </div>
            <div id="noiseControls" class="control-box">
                <h4>Noise Controls</h4>
                <div id="noiseControlsContainer">
                    <div id="noiseMainControls">
                        <label>Type: 
                            <select id="noiseType">
                                <option value="perlin">Perlin</option>
                                <option value="simplex">Simplex</option>
                                <option value="ridged">Ridged</option>
                                <option value="billowy">Billowy</option>
                            </select>
                        </label>
                        <label>Base Freq: <input id="noiseFreq" type="range" min="0.005" max="0.1" step="0.005" value="0.02"><span class="value-display" id="noiseFreqValue">0.02</span></label>
                        <label>Octaves: <input id="noiseOctaves" type="range" min="1" max="6" step="1" value="3"><span class="value-display" id="noiseOctavesValue">3</span></label>
                        <label>Persistence: <input id="noisePersistence" type="range" min="0.1" max="0.9" step="0.1" value="0.5"><span class="value-display" id="noisePersistenceValue">0.5</span></label>
                        <label>Lacunarity: <input id="noiseLacunarity" type="range" min="1.5" max="3.0" step="0.1" value="2.0"><span class="value-display" id="noiseLacunarityValue">2.0</span></label>
                        <label>Gain: <input id="noiseGain" type="range" min="0.5" max="5.0" step="0.1" value="1.0"><span class="value-display" id="noiseGainValue">1.0</span></label>
                        <label>Offset: <input id="noiseOffset" type="range" min="-2.0" max="1.0" step="0.05" value="0.3"><span class="value-display" id="noiseOffsetValue">0.3</span></label>
                        <label>Warp Strength: <input id="noiseWarpStrength" type="range" min="0" max="20" step="1" value="0"><span class="value-display" id="noiseWarpStrengthValue">0</span></label>
                    </div>
                    <div id="octaveControls"></div>
                </div>
            </div>
        </div>
        <div id="bottomControls">
            <div id="legend" class="control-box">
                <h4>Legend</h4>
                <div id="legendItems"></div>
            </div>
            <div id="controlsBox" class="control-box">
                <div class="control-item"><code>LMB</code> Set depth=0</div>
                <div class="control-item"><code>RMB</code> Set to min neighbor</div>
                <div class="control-item"><code>ALT+LMB</code> Increase depth</div>
                <div class="control-item"><code>ALT+RMB</code> Decrease depth</div>
                <div class="control-item"><code>SHIFT+LMB</code> Add outlet pump</div>
                <div class="control-item"><code>SHIFT+RMB</code> Add inlet pump</div>
                <div class="control-item"><code>SHIFT+CTRL+LMB</code> Link pump to reservoir</div>
                <div class="control-item"><code>CTRL+LMB</code> Flood fill</div>
                <div class="control-item"><code>CTRL+RMB</code> Flood empty</div>
            </div>
            <div id="labelControls" class="control-box">
                <h4>Drawing Labels</h4>
                <div class="control-item">
                    <label><input type="checkbox" id="showDepthLabels" checked> Show Depth</label>
                </div>
                <div class="control-item">
                    <label><input type="checkbox" id="showPumpLabels" checked> Show Pump IDs</label>
                </div>
                <div class="control-item">
                    <label><input type="checkbox" id="showBasinLabels"> Show Basin IDs</label>
                </div>
            </div>
        </div>
                <div id="debugContainer">
            <div id="basinsDebug" class="control-box">
                <h4 id="basinsTitle">Basins
                </h4>
                <div id="basinsText"></div>
            </div>
            <div id="reservoirsDebug" class="control-box">
                <h4>Pumps 
                    <label style="font-weight: normal; font-size: var(--font-size-0); margin-left: var(--size-2);">
                        Select Reservoir: <input type="number" id="reservoirInput" min="0" value="0" style="width: 60px;" placeholder="ID">
                    </label>
                </h4>
                <div id="reservoirsText"></div>
            </div>
        </div>
    </div>
    <script type="module" src="app.js"></script>
</body>
</html>
